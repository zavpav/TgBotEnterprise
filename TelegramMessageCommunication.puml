@startuml Update/new messages in telegram service

title Processing some message from A service to telegram user\nFor examle it is called "(change) Status"

participant "A service" as srv
participant "MainBot" as mb
participant "Telegram\nservice" as tg
actor "User" as usr

== Message generated by service ==
srv -> mb : Status changed
note right mb : Find internal MessageId\nfor changing status from the service\n\nIf a MessageId doesn't exist\nit will be generated
alt Find MessageId
mb -> mb : Find\ninternal message id
else MessageId doesn't find
mb -> mb : Generate\ninternal message id

end
mb -> mb : Generate messages\nfor telegram
mb -> tg : Send generated messages
tg -> tg : Find telegram message id\n by internal MessageId
alt Found telegram message id
tg -> usr : Update message with new data
else 
tg -> usr : Send new message
tg -> tg : Save telegram message id
end

...
== Rerequest information by user ==
usr -> tg : Request infromation
tg -> mb : Request information by user
mb -> mb : Identify type of infromation
mb -> mb : Find internal message id for this request
mb -> tg : Delete internal MessageId for this user
mb -> srv : Request infromation
mb <-- srv: Response information
mb -> mb : Generate telegram messages
mb -> tg : Send messages 
tg -> usr: Send new messages\n[because message id was deleted]

@enduml